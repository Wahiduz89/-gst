// prisma/schema.prisma - Production Ready Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                String    @id @default(cuid())
  name              String
  email             String    @unique
  password          String
  businessName      String    @default("")
  businessAddress   String    @default("")
  businessGST       String?
  businessPAN       String?   // New field for PAN
  businessPhone     String?
  businessEmail     String?
  businessState     String    @default("Assam")
  businessLogo      String?   // New field for logo URL/path
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  invoices          Invoice[]
  customers         Customer[]
}

model Customer {
  id         String    @id @default(cuid())
  name       String
  gstNumber  String?
  panNumber  String?   // Optional PAN for customers
  address    String
  phone      String?
  email      String?
  state      String    @default("")
  userId     String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoices   Invoice[]
  
  @@index([userId])
  @@index([name])
  @@index([gstNumber])
}

model Invoice {
  id              String          @id @default(cuid())
  invoiceNumber   String          @unique
  invoiceDate     DateTime        @default(now())
  userId          String
  customerId      String?
  customerName    String
  customerGST     String?
  customerAddress String
  customerPhone   String?
  customerEmail   String?
  businessState   String          @default("Assam")
  customerState   String          @default("")
  subtotal        Decimal
  cgst            Decimal
  sgst            Decimal
  igst            Decimal
  totalAmount     Decimal
  isInterState    Boolean         @default(false)
  status          InvoiceStatus   @default(DRAFT)
  dueDate         DateTime?
  termsConditions String?
  notes           String?
  paymentStatus   PaymentStatus   @default(PENDING)
  paidAmount      Decimal         @default(0)
  paymentDate     DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  customer        Customer?       @relation(fields: [customerId], references: [id], onDelete: SetNull)
  items           InvoiceItem[]
  
  @@index([userId])
  @@index([customerId])
  @@index([invoiceNumber])
  @@index([status])
  @@index([createdAt])
  @@index([invoiceDate])
  @@index([paymentStatus])
}

model InvoiceItem {
  id                String    @id @default(cuid())
  invoiceId         String
  description       String
  quantity          Decimal
  rate              Decimal
  amount            Decimal
  gstRate           Decimal
  cgst              Decimal
  sgst              Decimal
  igst              Decimal
  totalAmount       Decimal
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  invoice           Invoice   @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  
  @@index([invoiceId])
}

enum InvoiceStatus {
  DRAFT
  GENERATED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
}