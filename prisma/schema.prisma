// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(cuid())
  name          String    // Add this line
  email         String    @unique
  password      String
  businessName  String    @default("")
  businessAddress String  @default("")
  businessGST   String?
  businessPhone String?
  businessEmail String?
  businessState String    @default("Assam")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  invoices      Invoice[]
  customers     Customer[]
}

model Customer {
  id         String    @id @default(cuid())
  name       String
  gstNumber  String?
  address    String
  phone      String?
  email      String?
  state      String    @default("")
  userId     String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoices   Invoice[]
  
  @@index([userId])
  @@index([name])
  @@index([gstNumber])
}

model Invoice {
  id              String          @id @default(cuid())
  invoiceNumber   String          @unique
  invoiceDate     DateTime        @default(now())  // Add this line
  userId          String
  customerId      String?
  customerName    String          // Add this line  
  customerGST     String?         // Add this line
  customerAddress String          // Add this line
  customerPhone   String?         // Add this line
  customerEmail   String?         // Add this line
  businessState   String          @default("Assam")
  customerState   String          @default("")
  subtotal        Decimal
  cgst            Decimal
  sgst            Decimal
  igst            Decimal
  totalAmount     Decimal
  isInterState    Boolean         @default(false)  // Add this line
  status          InvoiceStatus   @default(DRAFT)
  dueDate         DateTime?
  termsConditions String?
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  customer        Customer?       @relation(fields: [customerId], references: [id], onDelete: SetNull)
  items           InvoiceItem[]
  
  @@index([userId])
  @@index([customerId])
  @@index([invoiceNumber])
  @@index([status])
  @@index([createdAt])
  @@index([invoiceDate])
}

model InvoiceItem {
  id            String    @id @default(cuid())
  invoiceId     String
  description   String
  quantity      Decimal
  rate          Decimal
  amount        Decimal
  gstRate       Decimal
  cgst          Decimal
  sgst          Decimal
  igst          Decimal
  totalAmount   Decimal
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  invoice       Invoice   @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  
  @@index([invoiceId])
}

enum InvoiceStatus {
  DRAFT
  GENERATED
  CANCELLED
}